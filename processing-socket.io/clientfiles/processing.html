<html>
<head>
  <script src="js/processing.js"></script>
  <script src="/socket.io/socket.io.js"></script> 
</head>
<body><h1>Processing.js</h1>

<p><canvas id="canvas1" width="800" height="400"></canvas></p>

<script id="script1" type="text/javascript">

// Simple way to attach js code to the canvas is by using a function
function sketchProc(processing) {
    var col;
    var history;

    var font;

    var MAX_VALUES = 20;
    var BAR_X_SIZE = 40;
    var BAR_Y_SIZE = 300;

    //get data from socket.io
    var socket = io.connect();
    socket.on('bang', function (data) {
        console.log(data.temp);

        for (var i = 1; i < history.length; i++) {
          history[i-1] = history[i];
        }

        history[MAX_VALUES-1] = data.temp*BAR_Y_SIZE;
    });

    processing.setup = function() {
      // erase background
      processing.size(800, 400);      
      col = processing.color(255, 255, 0);

      font = processing.loadFont("Thonburi.ttf"); 
      processing.textFont(font, 16); 
      processing.textAlign(processing.CENTER);

      history = new Array(MAX_VALUES);
      for (var i = 0; i < history.length; i++) {
        history[i] = 0;
      }
    }

    // Override draw function, by default it will be called 60 times per second
    processing.draw = function() {
      // determine center and max clock arm length
      //var centerX = processing.width / 2, centerY = processing.height / 2;
      processing.background(0);

      processing.fill(col);
      processing.noStroke();

      var xofs=0;
      for (var i = 0; i < history.length; i++) {
        processing.rect(xofs, 310, BAR_X_SIZE-1, 0-history[i]);

        var ii=parseInt(history[i]/10);
        processing.text(""+ii, xofs, 320, BAR_X_SIZE, 30);

        xofs += BAR_X_SIZE;
      }

    }; 
}

var canvas = document.getElementById("canvas1");
// attaching the sketchProc function to the canvas
var p = new Processing(canvas, sketchProc);
// p.exit(); to detach it
</script>
</body>
</html>
