<!DOCTYPE HTML>
<html>
<head>
  <script src="js/processing.js"></script>
  <script src="/socket.io/socket.io.js"></script> 
  <meta charset="utf-8">
  <link rel="stylesheet" href="bootstrap/css/bootstrap.css">
  <link rel="stylesheet" href="bootstrap/css/bootstrap-responsive.css">
  
  <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
  </style>  

</head>
<body>

<!-- Bootstrap Header Bar -->
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Neophob.com</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="active"><a href="#">Home</a></li>
              <!-- <li><a href="#about">About</a></li>
              <li><a href="#contact">Contact</a></li> -->
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

<!-- Bootstrap content -->
    <div class="container">
      <!-- Main hero unit for a primary marketing message or call to action -->
      <div class="hero-unit">
        <h1>Node.js, Socket.io... </h1>
        <p>... Twitter Bootstrap and Processing.js example project. The Node.js server application
          sends data via Socket.io to the Client. The Client HTML code use Twitter Bootstrap to
          render the basic site layout, the main content is created by Processing.js.</p>
        <!-- <p><a class="btn btn-primary btn-large">Learn more &raquo;</a></p> -->
        <p><center><canvas id="canvas1" width="800" height="400"></canvas></center></p>

        <blockquote>
          <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer posuere erat a ante venenatis.</p>
          <small>Someone famous</small>
        </blockquote>
      </div>

      <footer>
        <p>&copy; Michael Vogt 2012, Built for and maintained by the community via <a href="https://github.com/neophob">GitHub</a>.</p>
      </footer>
    
    </div>    

<!-- Processing Code-->

<script id="script1" type="text/javascript">

// Simple way to attach js code to the canvas is by using a function
function sketchProc(processing) {
    var col;
    var history;

    var font;

    var MAX_VALUES = 20;
    var BAR_X_SIZE = 40;
    var BAR_Y_SIZE = 300;

    //get data from socket.io
    var socket = io.connect();
    socket.on('bang', function (data) {
        console.log(data.temp);

        for (var i = 1; i < history.length; i++) {
          history[i-1] = history[i];
        }

        history[MAX_VALUES-1] = data.temp;
    });

    processing.setup = function() {
      // erase background
      processing.size(800, 400);      
      col = processing.color(255, 255, 0);

      font = processing.loadFont("Thonburi.ttf"); 
      processing.textFont(font, 16); 
      processing.textAlign(processing.CENTER);

      history = new Array(MAX_VALUES);
      for (var i = 0; i < history.length; i++) {
        history[i] = 0;
      }
    }

    // Override draw function, by default it will be called 60 times per second
    processing.draw = function() {
      // determine center and max clock arm length
      //var centerX = processing.width / 2, centerY = processing.height / 2;
      processing.background(0);

      processing.fill(col);
      processing.noStroke();

      var xofs=0;
      for (var i = 0; i < history.length; i++) {
        processing.rect(xofs, 310, BAR_X_SIZE-1, 0-history[i]*10);
        processing.text(history[i], xofs, 320, BAR_X_SIZE, 30);

        xofs += BAR_X_SIZE;
      }

    }; 
}

var canvas = document.getElementById("canvas1");
// attaching the sketchProc function to the canvas
var p = new Processing(canvas, sketchProc);
// p.exit(); to detach it
</script>
</body>
</html>
